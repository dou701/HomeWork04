<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>訂單查詢</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .filter-section {
            margin-bottom: 20px;
        }
        .filter-section label, .filter-section input {
            margin-right: 10px;
        }
        .autocomplete-items {
            position: relative;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
        }
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
        }
        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }
        .autocomplete-active {
            background-color: DodgerBlue !important;
            color: #ffffff;
        }
        #actionPanel {
            margin-top: 10px;
            text-align: right;
        }
    </style>
</head>
<body>
    <h2>訂單查詢</h2>

    <div class="filter-section">
        <label for="orderNumber">訂單編號:</label>
        <input id="orderNumber" type="text" name="orderNumber" placeholder="輸入訂單編號">

        <label for="startDate">開始日期:</label>
        <input type="date" id="startDate" name="startDate">

        <label for="endDate">結束日期:</label>
        <input type="date" id="endDate" name="endDate">

        <label for="member">會員:</label>
        <input id="member" type="text" name="member" placeholder="輸入會員名稱">

        <label for="product">產品:</label>
        <input id="product" type="text" name="product" placeholder="輸入產品名稱">

        <button onclick="filterOrders()">查詢</button>
    </div>

    <table id="orderTable">
        <thead>
            <tr>
                <th>訂單編號</th>
                <th>訂購日期</th>
                <th>會員名稱</th>
                <th>產品名稱</th>
                <th>數量</th>
                <th>總金額</th>
                <th>狀態</th>
                <th>變動</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be dynamically generated by JavaScript -->
        </tbody>
    </table>

    <div id="actionPanel">
        <button onclick="deleteSelected()">刪除訂單</button>
        <label for="selectAll">全選</label>
        <input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)">
    </div>

    <script>
        function filterOrders() {
            var orderNumber = document.getElementById('orderNumber').value;
            var startDate = document.getElementById('startDate').value;
            var endDate = document.getElementById('endDate').value;
            var member = document.getElementById('member').value;
            var product = document.getElementById('product').value;

            // Mock data for demonstration
            var orders = [
                {
                    orderNumber: '0001',
                    orderDate: '2023-01-01',
                    memberName: '會員A',
                    productName: '產品X',
                    quantity: 2,
                    totalAmount: 2000,
                    status: '已完成'
                },
                {
                    orderNumber: '0002',
                    orderDate: '2024-05-07',
                    memberName: '會員A',
                    productName: '產品X3',
                    quantity: 2,
                    totalAmount: 12000,
                    status: '已完成'
                },
                {
                    orderNumber: '0003',
                    orderDate: '2024-06-04',
                    memberName: '會員B',
                    productName: '吹風機',
                    quantity: 1,
                    totalAmount: 100000,
                    status: '未付款'
                }
            ];

            var filteredOrders = orders.filter(order => {
                var isMatch = true;
                if (orderNumber) {
                    isMatch = isMatch && order.orderNumber.includes(orderNumber);
                }
                if (startDate) {
                    isMatch = isMatch && new Date(order.orderDate) >= new Date(startDate);
                }
                if (endDate) {
                    isMatch = isMatch && new Date(order.orderDate) <= new Date(endDate);
                }
                if (member) {
                    isMatch = isMatch && order.memberName.includes(member);
                }
                if (product) {
                    isMatch = isMatch && order.productName.includes(product);
                }
                return isMatch;
            });

            updateOrderTable(filteredOrders);
        }

        function updateOrderTable(orders) {
            var tableBody = document.querySelector('#orderTable tbody');
            tableBody.innerHTML = '';

            orders.forEach(order => {
                var newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${order.orderNumber}</td>
                    <td>${order.orderDate}</td>
                    <td>${order.memberName}</td>
                    <td>${order.productName}</td>
                    <td>${order.quantity}</td>
                    <td>${order.totalAmount}</td>
                    <td>${order.status}</td>
                    <td>
                        <button onclick="editOrder('${order.orderNumber}')">修改</button>
                        <button onclick="deleteOrder('${order.orderNumber}')">刪除</button>
                        <input type="checkbox" class="orderCheckbox">
                    </td>
                `;
                tableBody.appendChild(newRow);
            });
        }

        function editOrder(orderNumber) {
            // Placeholder for edit functionality
            alert('Edit order: ' + orderNumber);

            // Example of collecting updated data (not implemented here)

            // Example of making a POST request to backend API
            // fetch('/api/updateOrder', {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //     },
            //     body: JSON.stringify(updatedOrder),
            // })
            // .then(response => response.json())
            // .then(data => {
            //     alert('Order updated successfully');
            //     // Optionally, update UI or fetch updated data from server
            //     filterOrders(); // Refresh orders after update
            // })
            // .catch(error => {
            //     console.error('Error updating order:', error);
            //     alert('Failed to update order. Please try again later.');
            // });
        }

        function deleteOrder(orderNumber) {
            // Placeholder for delete functionality
            alert('Delete order: ' + orderNumber);

            // Example of making a DELETE request to backend API
            // fetch(`/api/deleteOrder/${orderNumber}`, {
            //     method: 'DELETE',
            // })
            // .then(response => response.json())
            // .then(data => {
            //     alert('Order deleted successfully');
            //     // Optionally, update UI or fetch updated data from server
            //     filterOrders(); // Refresh orders after delete
            // })
            // .catch(error => {
            //     console.error('Error deleting order:', error);
            //     alert('Failed to delete order. Please try again later.');
            // });
        }

        function deleteSelected() {
            // Placeholder for delete selected functionality
            var checkboxes = document.querySelectorAll('.orderCheckbox:checked');
            var selectedOrders = [];
            checkboxes.forEach(function(checkbox) {
                var orderNumber = checkbox.parentNode.parentNode.cells[0].textContent;
                selectedOrders.push(orderNumber);
            });
            if (selectedOrders.length > 0) {
                if (confirm('確定要刪除選中的訂單嗎？')) {
                    // Implement delete logic here
                    selectedOrders.forEach(function(orderNumber) {
                        deleteOrder(orderNumber); // Call deleteOrder function for each selected order
                    });
                }
            } else {
                alert('請先選擇要刪除的訂單');
            }
        }

        function toggleSelectAll(checkbox) {
            var checkboxes = document.querySelectorAll('.orderCheckbox');
            checkboxes.forEach(function(cb) {
                cb.checked = checkbox.checked;
            });
        }

        // Initial call to populate table with all orders
        filterOrders();
    </script
>
</body>
</html>
